ypos=c(box[2,i]-width[i],box[2,i]+width[i])
zpos <- 0.
print(paste("Extracting",parameter, id, "data from Box",i, sep=' '))
if(include.z) dat<-rxtracto_3D(dataInfo,parameter,xcoord=xpos,ycoord=ypos,tcoord=tpos,zcoord=zpos)
if(!include.z) dat<-rxtracto_3D(dataInfo,parameter,xcoord=xpos,ycoord=ypos,tcoord=tpos)
if(include.z) dat[[parameter]]<-drop(dat[[parameter]])
avg<-NULL
#Calculate the average for each point in the time series
for (x in 1:dim(dat[[parameter]])[3]) avg<-c(avg, mean(dat[[parameter]][,,x], na.rm=TRUE))
avg[is.na(avg)]<-NA
dates<-dat[["time"]]
if(i==1) alldat<-data.frame(dates=dates, stringsAsFactors=FALSE)
alldat=cbind(alldat,avg)
}
#Create the data.frame with the Year, Month and covariates in each box
covnames = paste(tag,1:ncol(box),sep="")
colnames(alldat)=c("Dates",covnames)
yr1=format(as.Date(tt[2]),"%Y")
yr2=format(as.Date(tt[1]),"%Y")
#create data.frame with all months are present and file starts with Jan and ends with Dec
fullalldat=data.frame(Year=rep(yr1:yr2,each=12),Month=rep(1:12,length(yr1:yr2)))
fullalldat[covnames]=NA #add on covariates
#add year and month to alldat
alldat = cbind(Year=as.numeric(format(alldat$Dates,"%Y")),
Month=as.numeric(format(alldat$Dates,"%m")),
alldat)
#make sure each month is present in each year and file starts with Jan and ends with Dec
browser()
for(irow in 1:dim(alldat)[1]){
fullalldat[fullalldat$Year==alldat$Year[irow] & fullalldat$Month==alldat$Month[irow],covnames]=
alldat[irow,covnames]
}
if(save.csv) write.csv(fullalldat, paste(parameter,"-", id,"-",yr1,"-",yr2,".csv",sep=""),row.names=FALSE)
#clean up
if(clean) file.remove(Sys.glob("*.nc"))
invisible(fullalldat)
}
parameter <-'sst'
id <- 'erdAGsstamday'
tag <- "SST."
sstupwelling=getdat(parameter, id, tag,  boxes.upw, save.csv=FALSE, include.z=TRUE)
upw.sst = with(sstupwelling,
data.frame(Year=Year, Month=Month,
UPW.1=SST.6-SST.1,
UPW.2=SST.7-SST.2,
UPW.3=SST.8-SST.3,
UPW.4=SST.9-SST.4,
UPW.5=SST.10-SST.5))
yr1=min(upw.sst$Year); yr2=max(upw.sst$Year)
tmpb=with(upw.sst[upw.sst$Year>=2004 & upw.sst$Year<= 2012,], data.frame(Year=Year,Month=Month,UPW.5=UPW.5))
tmpa=with(seio_covariates_mon[seio_covariates_mon$Year>=2004 & seio_covariates_mon$Year<= 2012,], data.frame(Year=Year,Month=Month,UPW.5=UPW.5))
plot(tmpb$UPW.5,tmpa$UPW.5)
getdat = function(parameter, id, tag, box, clean=TRUE, save.csv=TRUE, include.z=FALSE){
dataInfo <- rerddap::info(id)
#get data range from dataset
global <- dataInfo$alldata$NC_GLOBAL
tt <- global[global$attribute_name %in% c("time_coverage_end", "time_coverage_start"), "value", ]
cat(sprintf("     time: (%s, %s)", tt[2], tt[1]));cat("\n")
tpos<-c(tt[2],tt[1]) # times must be within timerange of dataset
for (i in 1:ncol(box)) {
xpos=c(box[1,i]-width[i],box[1,i]+width[i])
ypos=c(box[2,i]-width[i],box[2,i]+width[i])
zpos <- 0.
print(paste("Extracting",parameter, id, "data from Box",i, sep=' '))
if(include.z) dat<-rxtracto_3D(dataInfo,parameter,xcoord=xpos,ycoord=ypos,tcoord=tpos,zcoord=zpos)
if(!include.z) dat<-rxtracto_3D(dataInfo,parameter,xcoord=xpos,ycoord=ypos,tcoord=tpos)
if(include.z) dat[[parameter]]<-drop(dat[[parameter]])
avg<-NULL
#Calculate the average for each point in the time series
for (x in 1:dim(dat[[parameter]])[3]) avg<-c(avg, mean(dat[[parameter]][,,x], na.rm=TRUE))
avg[is.na(avg)]<-NA
dates<-dat[["time"]]
if(i==1) alldat<-data.frame(dates=dates, stringsAsFactors=FALSE)
alldat=cbind(alldat,avg)
}
#Create the data.frame with the Year, Month and covariates in each box
covnames = paste(tag,1:ncol(box),sep="")
colnames(alldat)=c("Dates",covnames)
yr1=format(as.Date(tt[2]),"%Y")
yr2=format(as.Date(tt[1]),"%Y")
#create data.frame with all months are present and file starts with Jan and ends with Dec
fullalldat=data.frame(Year=rep(yr1:yr2,each=12),Month=rep(1:12,length(yr1:yr2)))
fullalldat[covnames]=NA #add on covariates
#add year and month to alldat
alldat = cbind(Year=as.numeric(format(alldat$Dates,"%Y")),
Month=as.numeric(format(alldat$Dates,"%m")),
alldat)
#make sure each month is present in each year and file starts with Jan and ends with Dec
for(irow in 1:dim(alldat)[1]){
fullalldat[fullalldat$Year==alldat$Year[irow] & fullalldat$Month==alldat$Month[irow],covnames]=
alldat[irow,covnames]
}
if(save.csv) write.csv(fullalldat, paste(parameter,"-", id,"-",yr1,"-",yr2,".csv",sep=""),row.names=FALSE)
#clean up
if(clean) file.remove(Sys.glob("*.nc"))
invisible(fullalldat)
}
parameter <-'sst'
id <- 'erdAGsstamday'
tag <- "SST."
sstupwelling=getdat(parameter, id, tag,  boxes.upw, save.csv=FALSE, include.z=TRUE)
upw.sst = with(sstupwelling,
data.frame(Year=Year, Month=Month,
UPW.1=SST.6-SST.1,
UPW.2=SST.7-SST.2,
UPW.3=SST.8-SST.3,
UPW.4=SST.9-SST.4,
UPW.5=SST.10-SST.5))
yr1=min(upw.sst$Year); yr2=max(upw.sst$Year)
tmpb=with(upw.sst[upw.sst$Year>=2004 & upw.sst$Year<= 2012,], data.frame(Year=Year,Month=Month,UPW.5=UPW.5))
tmpa=with(seio_covariates_mon[seio_covariates_mon$Year>=2004 & seio_covariates_mon$Year<= 2012,], data.frame(Year=Year,Month=Month,UPW.5=UPW.5))
plot(tmpb$UPW.5,tmpa$UPW.5)
head(tmpb)
head(tmpa)
tmpb=with(upw.sst[upw.sst$Year>=2004 & upw.sst$Year<= 2012,], data.frame(Year=Year,Month=Month,UPW=UPW.4))
tmpa=with(seio_covariates_mon[seio_covariates_mon$Year>=2004 & seio_covariates_mon$Year<= 2012,], data.frame(Year=Year,Month=Month,UPW=UPW.4))
plot(tmpb$UPW,tmpa$UPW)
tmpc=with(upw.sst.icoad[upw.sst.icoad$Year>=2004 & upw.sst.icoad$Year<= 2012,], data.frame(Year=Year,Month=Month,UPW=UPW.4))
plot(tmpb$UPW.5,tmpc$UPW.5)
tmpc
tmpb
plot(tmpb$UPW,tmpc$UPW)
y1=1982; y2=2012
tmpc=with(upw.sst.icoad[upw.sst.icoad$Year>=y1 & upw.sst.icoad$Year<= y2,], data.frame(Year=Year,Month=Month,UPW=UPW.4))
tmpb=with(upw.sst[upw.sst$Year>=y1 & upw.sst$Year<= y2,], data.frame(Year=Year,Month=Month,UPW=UPW.4))
plot(tmpb$UPW,tmpa$UPW)
boxes.upw<-matrix(c(74.7, 12.5,
75.4, 11.5,
75.8, 10.5,
76, 9.5,
76.8, 8.5,
71.7, 12.5,
72.4, 11.5,
72.8, 10.5,
73, 9.5,
73.8, 8.5),ncol=10,nrow=2)
parameter <-'sst'
id <- 'esrlIcoads1ge'
tag <- "SST."
sstupwelling=getdat(parameter, id, tag,  boxes.upw, save.csv=FALSE, include.z=FALSE)
upw.sst = with(sstupwelling,
data.frame(Year=Year, Month=Month,
UPW.1=SST.6-SST.1,
UPW.2=SST.7-SST.2,
UPW.3=SST.8-SST.3,
UPW.4=SST.9-SST.4,
UPW.5=SST.10-SST.5))
yr1=min(upw.sst$Year); yr2=max(upw.sst$Year)
upw.sst.icoad=upw.sst
write.csv(upw.sst, paste("upw.sst","-", id,"-",yr1,"-",yr2,".csv",sep=""),row.names=FALSE)
tmpc=with(upw.sst.icoad[upw.sst.icoad$Year>=y1 & upw.sst.icoad$Year<= y2,], data.frame(Year=Year,Month=Month,UPW=UPW.4))
tmpb=with(upw.sst[upw.sst$Year>=y1 & upw.sst$Year<= y2,], data.frame(Year=Year,Month=Month,UPW=UPW.4))
plot(tmpb$UPW,tmpa$UPW)
plot(tmpb$UPW,tmpc$UPW)
tmpc=with(upw.sst.icoad[upw.sst.icoad$Year>=y1 & upw.sst.icoad$Year<= y2,], data.frame(Year=Year,Month=Month,UPW=UPW.4))
tmpb=with(upw.sst[upw.sst$Year>=y1 & upw.sst$Year<= y2,], data.frame(Year=Year,Month=Month,UPW=UPW.4))
plot(tmpb$UPW,tmpc$UPW)
parameter <-'sst'
id <- 'erdAGsstamday'
tag <- "SST."
sstupwelling=getdat(parameter, id, tag,  boxes.upw, save.csv=FALSE, include.z=TRUE)
upw.sst = with(sstupwelling,
data.frame(Year=Year, Month=Month,
UPW.1=SST.6-SST.1,
UPW.2=SST.7-SST.2,
UPW.3=SST.8-SST.3,
UPW.4=SST.9-SST.4,
UPW.5=SST.10-SST.5))
yr1=min(upw.sst$Year); yr2=max(upw.sst$Year)
upw.sst.AG=upw.sst
write.csv(upw.sst, paste("upw.sst","-", id,"-",yr1,"-",yr2,".csv",sep=""),row.names=FALSE)
tmpc=with(upw.sst.icoad[upw.sst.icoad$Year>=y1 & upw.sst.icoad$Year<= y2,], data.frame(Year=Year,Month=Month,UPW=UPW.4))
tmpb=with(upw.sst.AG[upw.sst.AG$Year>=y1 & upw.sst.AG$Year<= y2,], data.frame(Year=Year,Month=Month,UPW=UPW.4))
plot(tmpb$UPW,tmpc$UPW)
y1=1982; y2=2012
tmpc=with(upw.sst.icoad[upw.sst.icoad$Year>=y1 & upw.sst.icoad$Year<= y2,], data.frame(Year=Year,Month=Month,UPW=UPW.4))
tmpb=with(upw.sst.AG[upw.sst.AG$Year>=y1 & upw.sst.AG$Year<= y2,], data.frame(Year=Year,Month=Month,UPW=UPW.4))
plot(tmpb$UPW,tmpc$UPW)
tmpb
y1=2003; y2=2012
tmpc=with(upw.sst.icoad[upw.sst.icoad$Year>=y1 & upw.sst.icoad$Year<= y2,], data.frame(Year=Year,Month=Month,UPW=UPW.4))
tmpb=with(upw.sst.AG[upw.sst.AG$Year>=y1 & upw.sst.AG$Year<= y2,], data.frame(Year=Year,Month=Month,UPW=UPW.4))
plot(tmpb$UPW,tmpc$UPW)
boxes.cut<-matrix(c(76.5, 9.5,
76, 9.5,
75.5, 9.5,
75, 9.5,
74.5, 9.5,
74, 9.5,
73.5, 9.5,
73, 9.5,
72.5, 9.5,
72, 9.5),ncol=10,nrow=2)
parameter <-'sst'
id <- 'erdAGsstamday'
tag <- "SST."
sstcut=getdat(parameter, id, tag,  boxes.cut, save.csv=FALSE, include.z=TRUE)
sstcut
plot(sstcut[19,3:12])
(sstcut[19,3:12])
plot(as.vector(sstcut[19,3:12])
)
plot(as.vector(sstcut[19,3:12]))
(as.vector(sstcut[19,3:12]))
class(as.vector(sstcut[19,3:12]))
class(c(sstcut[19,3:12]))
class(t(sstcut[19,3:12]))
plot(t(sstcut[19,3:12]))
plot(t(sstcut[20,3:12]))
plot(t(sstcut[20,3:12]));title(sstcut$Month[20])
i=18;plot(t(sstcut[i,3:12]));title(sstcut$Month[i])
i=18;plot(t(sstcut[i,3:12]),ylim=c(25,29));title(sstcut$Month[i])
i=19;plot(t(sstcut[i,3:12]),ylim=c(25,29));title(sstcut$Month[i])
i=20;plot(t(sstcut[i,3:12]),ylim=c(25,29));title(sstcut$Month[i])
i=21;plot(t(sstcut[i,3:12]),ylim=c(25,29));title(sstcut$Month[i])
i=22;plot(t(sstcut[i,3:12]),ylim=c(25,29));title(sstcut$Month[i])
i=22;plot(t(sstcut[i,3:12]),ylim=c(25,31));title(sstcut$Month[i])
i=23;plot(t(sstcut[i,3:12]),ylim=c(25,31));title(sstcut$Month[i])
i=24;plot(t(sstcut[i,3:12]),ylim=c(25,31));title(sstcut$Month[i])
i=25;plot(t(sstcut[i,3:12]),ylim=c(25,31));title(sstcut$Month[i])
i=26;plot(t(sstcut[i,3:12]),ylim=c(25,31));title(sstcut$Month[i])
i=27;plot(t(sstcut[i,3:12]),ylim=c(25,31));title(sstcut$Month[i])
i=28;plot(t(sstcut[i,3:12]),ylim=c(25,31));title(sstcut$Month[i])
i=29;plot(t(sstcut[i,3:12]),ylim=c(25,31));title(sstcut$Month[i])
i=30;plot(t(sstcut[i,3:12]),ylim=c(25,31));title(sstcut$Month[i])
i=31;plot(t(sstcut[i,3:12]),ylim=c(25,31));title(sstcut$Month[i])
i=32;plot(t(sstcut[i,3:12]),ylim=c(25,31));title(sstcut$Month[i])
i=33;plot(t(sstcut[i,3:12]),ylim=c(25,31));title(sstcut$Month[i])
parameter <-'sst'
id <- 'esrlIcoads1ge'
tag <- "SST."
sstcut.icoads=getdat(parameter, id, tag,  boxes.cut, save.csv=FALSE, include.z=TRUE)
parameter <-'sst'
id <- 'esrlIcoads1ge'
tag <- "SST."
sstcut.icoads=getdat(parameter, id, tag,  boxes.cut, save.csv=FALSE)
sstcut.AG=sstcut
sstcut$Year[19]
i=which(sstcut.icoads$Year==2004 & sstcut.icoads$Month==8);plot(t(sstcut.icoads[i,3:12]),ylim=c(25,31));title(sstcut.icoads$Month[i])
i=which(sstcut$Year==2004 & sstcut$Month==8);points(t(sstcut[i,3:12]),pch=2
)
i=which(sstcut.icoads$Year==2004 & sstcut.icoads$Month==6);plot(t(sstcut.icoads[i,3:12]),ylim=c(25,31));title(sstcut.icoads$Month[i])
i=which(sstcut$Year==2004 & sstcut$Month==6);points(t(sstcut[i,3:12]),pch=2)
i=which(sstcut.icoads$Year==2004 & sstcut.icoads$Month==9);plot(t(sstcut.icoads[i,3:12]),ylim=c(25,31));title(sstcut.icoads$Month[i])
i=which(sstcut$Year==2004 & sstcut$Month==9);points(t(sstcut[i,3:12]),pch=2)
i=which(sstcut.icoads$Year==2004 & sstcut.icoads$Month==8);plot(t(sstcut.icoads[i,3:12]),ylim=c(25,31));title(sstcut.icoads$Month[i])
i=which(sstcut$Year==2004 & sstcut$Month==8);points(t(sstcut[i,3:12]),pch=2)
i=which(sstcut.icoads$Year==2005 & sstcut.icoads$Month==8);plot(t(sstcut.icoads[i,3:12]),ylim=c(25,31));title(sstcut.icoads$Month[i])
i=which(sstcut$Year==2005 & sstcut$Month==8);points(t(sstcut[i,3:12]),pch=2)
parameter <-'sea_surface_temperature'
id <- 'erdPH2sstnmday'
tag <- "SST."
sstPH=getdat(parameter, id, tag,  boxes.cut, save.csv=FALSE, include.z=TRUE)
parameter <-'sea_surface_temperature'
id <- 'erdPH2sstnmday'
tag <- "SST."
sstPH=getdat(parameter, id, tag,  boxes.cut, save.csv=FALSE)
sstPH=read.csv("sea_surface_temperature-erdPH2sstnmday-1981-2012.csv")
i=which(sstcut.icoads$Year==2004 & sstcut.icoads$Month==8);plot(t(sstcut.icoads[i,3:12]),ylim=c(25,31));title(sstcut.icoads$Month[i])
i=which(sstcut$Year==2005 & sstcut$Month==8);points(t(sstcut[i,3:12]),pch=2)
i=which(sstcut.icoads$Year==2004 & sstcut.icoads$Month==8);plot(t(sstcut.icoads[i,3:12]),ylim=c(25,31));title(sstcut.icoads$Month[i])
i=which(sstcut$Year==2005 & sstcut$Month==8);points(t(sstcut[i,3:12]),pch=2)
i=which(sstcut.icoads$Year==2005 & sstcut.icoads$Month==8);plot(t(sstcut.icoads[i,3:12]),ylim=c(25,31));title(sstcut.icoads$Month[i])
i=which(sstcut$Year==2006 & sstcut$Month==8);points(t(sstcut[i,3:12]),pch=2)
i=which(sstcut$Year==2005 & sstcut$Month==8);points(t(sstcut[i,3:12]),pch=2)
i=which(sstcut.icoads$Year==2005 & sstcut.icoads$Month==8);plot(t(sstcut.icoads[i,3:12]),ylim=c(25,31));title(sstcut.icoads$Month[i])
i=which(sstcut$Year==2005 & sstcut$Month==8);points(t(sstcut[i,3:12]),pch=2)
i=which(sstcut.icoads$Year==2005 & sstcut.icoads$Month==8);sstcut.icoads$SST.2-sstcut.icoads$SST.6
i=which(sstcut.icoads$Year==2005 & sstcut.icoads$Month==8);sstcut.icoads$SST.2[i]-sstcut.icoads$SST.6[i]
i=which(sstcut.AG$Year==2005 & sstcut.AG$Month==8);sstcut.icoads$SST.2[i]-sstcut.icoads$SST.6[i]
i=which(sstcut.AG$Year==2004 & sstcut.AG$Month==8);sstcut.icoads$SST.2[i]-sstcut.icoads$SST.6[i]
i=which(sstcut.AG$Year==2004 & sstcut.AG$Month==8);sstcut.icoads$SST.2[i]-sstcut.icoads$SST.6[i]
i=which(sstcut.icoads$Year==2004 & sstcut.icoads$Month==8);sstcut.icoads$SST.2[i]-sstcut.icoads$SST.6[i]
yr=2004
i=which(sstcut.AG$Year==yr & sstcut.AG$Month==8);sstcut.AG$SST.2[i]-sstcut.AG$SST.6[i]
i=which(sstcut.icoads$Year==yr & sstcut.icoads$Month==8);sstcut.icoads$SST.2[i]-sstcut.icoads$SST.6[i]
i=which(sstcut.PH$Year==yr & sstcut.PH$Month==8);sstcut.PH$SST.4[i]-sstcut.PH$SST.11[i]
yr=2004
i=which(sstcut.AG$Year==yr & sstcut.AG$Month==8);sstcut.AG$SST.2[i]-sstcut.AG$SST.6[i]
i=which(sstcut.icoads$Year==yr & sstcut.icoads$Month==8);sstcut.icoads$SST.2[i]-sstcut.icoads$SST.6[i]
i=which(sstPH$Year==yr & sstPH$Month==8);sstPH$SST.4[i]-sstcut.PH$SST.11[i]
yr=2004
i=which(sstcut.AG$Year==yr & sstcut.AG$Month==8);sstcut.AG$SST.2[i]-sstcut.AG$SST.6[i]
i=which(sstcut.icoads$Year==yr & sstcut.icoads$Month==8);sstcut.icoads$SST.2[i]-sstcut.icoads$SST.6[i]
i=which(sstPH$Year==yr & sstPH$Month==8);sstPH$SST.4[i]-sstPH$SST.11[i]
i=which(sstcut.AG$Year==yr & sstcut.AG$Month==8);sstcut.AG$SST.2[i]-sstcut.AG$SST.6[i]
i=which(sstcut.AG$Year==yr & sstcut.AG$Month==8);sstcut.AG$SST.2[i]-sstcut.AG$SST.8[i]
i=which(sstcut.icoads$Year==yr & sstcut.icoads$Month==8);sstcut.icoads$SST.2[i]-sstcut.icoads$SST.6[i]
i=which(sstPH$Year==yr & sstPH$Month==8);sstPH$SST.4[i]-sstPH$SST.11[i]
i=which(sstcut.AG$Year==yr & sstcut.AG$Month==8);sstcut.AG$SST.2[i]-sstcut.AG$SST.6[i]
i=which(sstcut.AG$Year==yr & sstcut.AG$Month==8);sstcut.AG$SST.2[i]-sstcut.AG$SST.8[i]
i=which(sstcut.icoads$Year==yr & sstcut.icoads$Month==8);sstcut.icoads$SST.2[i]-sstcut.icoads$SST.6[i]
i=which(sstPH$Year==yr & sstPH$Month==8);sstPH$SST.4[i]-sstPH$SST.11[i]
i=which(sstcut.AG$Year==yr & sstcut.AG$Month==8);sstcut.AG$SST.2[i]-sstcut.AG$SST.6[i]
i=which(sstcut.AG$Year==yr & sstcut.AG$Month==8);sstcut.AG$SST.2[i]-sstcut.AG$SST.8[i]
i=which(sstcut.icoads$Year==yr & sstcut.icoads$Month==8);sstcut.icoads$SST.2[i]-sstcut.icoads$SST.6[i]
i=which(sstPH$Year==yr & sstPH$Month==8);sstPH$SST.4[i]-sstPH$SST.11[i]
yr=2005
i=which(sstcut.AG$Year==yr & sstcut.AG$Month==8);sstcut.AG$SST.2[i]-sstcut.AG$SST.6[i]
i=which(sstcut.AG$Year==yr & sstcut.AG$Month==8);sstcut.AG$SST.2[i]-sstcut.AG$SST.8[i]
i=which(sstcut.icoads$Year==yr & sstcut.icoads$Month==8);sstcut.icoads$SST.2[i]-sstcut.icoads$SST.6[i]
i=which(sstPH$Year==yr & sstPH$Month==8);sstPH$SST.4[i]-sstPH$SST.11[i]
yr=2006
i=which(sstcut.AG$Year==yr & sstcut.AG$Month==8);sstcut.AG$SST.2[i]-sstcut.AG$SST.6[i]
i=which(sstcut.AG$Year==yr & sstcut.AG$Month==8);sstcut.AG$SST.2[i]-sstcut.AG$SST.8[i]
i=which(sstcut.icoads$Year==yr & sstcut.icoads$Month==8);sstcut.icoads$SST.2[i]-sstcut.icoads$SST.6[i]
i=which(sstPH$Year==yr & sstPH$Month==8);sstPH$SST.4[i]-sstPH$SST.11[i]
yr=2007
i=which(sstcut.AG$Year==yr & sstcut.AG$Month==8);sstcut.AG$SST.2[i]-sstcut.AG$SST.6[i]
i=which(sstcut.AG$Year==yr & sstcut.AG$Month==8);sstcut.AG$SST.2[i]-sstcut.AG$SST.8[i]
i=which(sstcut.icoads$Year==yr & sstcut.icoads$Month==8);sstcut.icoads$SST.2[i]-sstcut.icoads$SST.6[i]
i=which(sstPH$Year==yr & sstPH$Month==8);sstPH$SST.4[i]-sstPH$SST.11[i]
yr=2008
i=which(sstcut.AG$Year==yr & sstcut.AG$Month==8);sstcut.AG$SST.2[i]-sstcut.AG$SST.6[i]
i=which(sstcut.AG$Year==yr & sstcut.AG$Month==8);sstcut.AG$SST.2[i]-sstcut.AG$SST.8[i]
i=which(sstcut.icoads$Year==yr & sstcut.icoads$Month==8);sstcut.icoads$SST.2[i]-sstcut.icoads$SST.6[i]
i=which(sstPH$Year==yr & sstPH$Month==8);sstPH$SST.4[i]-sstPH$SST.11[i]
sstPH
sstPH[200:300,]
sstPH[250:300,]
yr=2009
i=which(sstcut.AG$Year==yr & sstcut.AG$Month==8);sstcut.AG$SST.2[i]-sstcut.AG$SST.6[i]
i=which(sstcut.AG$Year==yr & sstcut.AG$Month==8);sstcut.AG$SST.2[i]-sstcut.AG$SST.8[i]
i=which(sstcut.icoads$Year==yr & sstcut.icoads$Month==8);sstcut.icoads$SST.2[i]-sstcut.icoads$SST.6[i]
i=which(sstPH$Year==yr & sstPH$Month==8);sstPH$SST.4[i]-sstPH$SST.11[i]
yr=2010
i=which(sstcut.AG$Year==yr & sstcut.AG$Month==8);sstcut.AG$SST.2[i]-sstcut.AG$SST.6[i]
i=which(sstcut.AG$Year==yr & sstcut.AG$Month==8);sstcut.AG$SST.2[i]-sstcut.AG$SST.8[i]
i=which(sstcut.icoads$Year==yr & sstcut.icoads$Month==8);sstcut.icoads$SST.2[i]-sstcut.icoads$SST.6[i]
i=which(sstPH$Year==yr & sstPH$Month==8);sstPH$SST.4[i]-sstPH$SST.11[i]
yr=2010; mon=6
i=which(sstcut.AG$Year==yr & sstcut.AG$Month==mon);sstcut.AG$SST.2[i]-sstcut.AG$SST.6[i]
i=which(sstcut.AG$Year==yr & sstcut.AG$Month==mon);sstcut.AG$SST.2[i]-sstcut.AG$SST.8[i]
i=which(sstcut.icoads$Year==yr & sstcut.icoads$Month==mon);sstcut.icoads$SST.2[i]-sstcut.icoads$SST.6[i]
i=which(sstPH$Year==yr & sstPH$Month==mon);sstPH$SST.4[i]-sstPH$SST.11[i]
yr=2008; mon=6
i=which(sstcut.AG$Year==yr & sstcut.AG$Month==mon);sstcut.AG$SST.2[i]-sstcut.AG$SST.6[i]
i=which(sstcut.AG$Year==yr & sstcut.AG$Month==mon);sstcut.AG$SST.2[i]-sstcut.AG$SST.8[i]
i=which(sstcut.icoads$Year==yr & sstcut.icoads$Month==mon);sstcut.icoads$SST.2[i]-sstcut.icoads$SST.6[i]
i=which(sstPH$Year==yr & sstPH$Month==mon);sstPH$SST.4[i]-sstPH$SST.11[i]
yr=2007; mon=6
i=which(sstcut.AG$Year==yr & sstcut.AG$Month==mon);sstcut.AG$SST.2[i]-sstcut.AG$SST.6[i]
i=which(sstcut.AG$Year==yr & sstcut.AG$Month==mon);sstcut.AG$SST.2[i]-sstcut.AG$SST.8[i]
i=which(sstcut.icoads$Year==yr & sstcut.icoads$Month==mon);sstcut.icoads$SST.2[i]-sstcut.icoads$SST.6[i]
i=which(sstPH$Year==yr & sstPH$Month==mon);sstPH$SST.4[i]-sstPH$SST.11[i]
i=which(sstPH$Year==yr & sstPH$Month==mon);plot(c(sstPH$SST.4[i],sstPH$SST.9[i],sstPH$SST.11[i]))
i=which(sstPH$Year==yr & sstPH$Month==mon);points(c(sstcut.AG$SST.2[i],sstcut.AG$SST.4[i],sstcut.AG$SST.6[i]),pch=2)
i=which(sstcut.AG$Year==yr & sstcut.AG$Month==mon);points(c(sstcut.AG$SST.2[i],sstcut.AG$SST.4[i],sstcut.AG$SST.6[i]),pch=2)
sstcut.AG$SST.2[i]
i=which(sstPH$Year==yr & sstPH$Month==mon);plot(c(sstPH$SST.4[i],sstPH$SST.9[i],sstPH$SST.11[i]),ylim=c(25,30))
i=which(sstcut.AG$Year==yr & sstcut.AG$Month==mon);points(c(sstcut.AG$SST.2[i],sstcut.AG$SST.4[i],sstcut.AG$SST.6[i]),pch=2)
i=which(sstcut.AG$Year==yr & sstcut.AG$Month==mon);points(c(sstcut.AG$SST.2[i],sstcut.AG$SST.4[i],sstcut.AG$SST.6[i]),pch=2)
yr=2003
i=which(sstPH$Year==yr & sstPH$Month==mon);plot(c(sstPH$SST.4[i],sstPH$SST.9[i],sstPH$SST.11[i]),ylim=c(25,30))
i=which(sstcut.AG$Year==yr & sstcut.AG$Month==mon);points(c(sstcut.AG$SST.2[i],sstcut.AG$SST.4[i],sstcut.AG$SST.6[i]),pch=2)
i=which(sstPH$Year==yr & sstPH$Month==mon);plot(c(sstPH$SST.4[i],sstPH$SST.9[i],sstPH$SST.11[i]),ylim=c(25,32))
i=which(sstcut.AG$Year==yr & sstcut.AG$Month==mon);points(c(sstcut.AG$SST.2[i],sstcut.AG$SST.4[i],sstcut.AG$SST.6[i]),pch=2)
sstcut.AG$SST.2[i]
yr=2008
i=which(sstPH$Year==yr & sstPH$Month==mon);plot(c(sstPH$SST.4[i],sstPH$SST.9[i],sstPH$SST.11[i]),ylim=c(25,32))
i=which(sstcut.AG$Year==yr & sstcut.AG$Month==mon);points(c(sstcut.AG$SST.2[i],sstcut.AG$SST.4[i],sstcut.AG$SST.6[i]),pch=2)
yr=2008; mon=8
i=which(sstPH$Year==yr & sstPH$Month==mon);plot(c(sstPH$SST.4[i],sstPH$SST.9[i],sstPH$SST.11[i]),ylim=c(25,32))
i=which(sstcut.AG$Year==yr & sstcut.AG$Month==mon);points(c(sstcut.AG$SST.2[i],sstcut.AG$SST.4[i],sstcut.AG$SST.6[i]),pch=2)
head(sstPH)
tmpa=with(seio_covariates_mon[seio_covariates_mon$Year>=2004 & seio_covariates_mon$Year<= 2012,], data.frame(Year=Year,Month=Month,UPW=UPW.4))
y1=2003; y2=2012
tmpb=with(sstPH[sstPH$Year>=y1 & sstPH$Year<= y2,], data.frame(Year=Year,Month=Month,UPW=SST.4-SST.11))
plot(tmpb$UPW,tmpa$UPW)
head(tmpb)
head(tmpa)
y1=2003; y2=2012
tmpa=with(seio_covariates_mon[seio_covariates_mon$Year>=y1 & seio_covariates_mon$Year<= y2,], data.frame(Year=Year,Month=Month,UPW=UPW.4))
tmpb=with(sstPH[sstPH$Year>=y1 & sstPH$Year<= y2,], data.frame(Year=Year,Month=Month,UPW=SST.4-SST.11))
plot(tmpb$UPW,tmpa$UPW)
getdat = function(parameter, id, tag, boxctrs, width, clean=TRUE, save.csv=TRUE, include.z=FALSE){
dataInfo <- rerddap::info(id)
#get data range from dataset
global <- dataInfo$alldata$NC_GLOBAL
tt <- global[global$attribute_name %in% c("time_coverage_end", "time_coverage_start"), "value", ]
cat(sprintf("     time: (%s, %s)", tt[2], tt[1]));cat("\n")
tpos<-c(tt[2],tt[1]) # times must be within timerange of dataset
for (i in 1:ncol(box)) {
xpos=c(box[1,i]-width[i],box[1,i]+width[i])
ypos=c(box[2,i]-width[i],box[2,i]+width[i])
zpos <- 0.
print(paste("Extracting",parameter, id, "data from Box",i, sep=' '))
if(include.z) dat<-rxtracto_3D(dataInfo,parameter,xcoord=xpos,ycoord=ypos,tcoord=tpos,zcoord=zpos)
if(!include.z) dat<-rxtracto_3D(dataInfo,parameter,xcoord=xpos,ycoord=ypos,tcoord=tpos)
if(include.z) dat[[parameter]]<-drop(dat[[parameter]])
avg<-NULL
#Calculate the average for each point in the time series
for (x in 1:dim(dat[[parameter]])[3]) avg<-c(avg, mean(dat[[parameter]][,,x], na.rm=TRUE))
avg[is.na(avg)]<-NA
dates<-dat[["time"]]
if(i==1) alldat<-data.frame(dates=dates, stringsAsFactors=FALSE)
alldat=cbind(alldat,avg)
}
#Create the data.frame with the Year, Month and covariates in each box
covnames = paste(tag,1:ncol(box),sep="")
colnames(alldat)=c("Dates",covnames)
yr1=format(as.Date(tt[2]),"%Y")
yr2=format(as.Date(tt[1]),"%Y")
#create data.frame with all months are present and file starts with Jan and ends with Dec
fullalldat=data.frame(Year=rep(yr1:yr2,each=12),Month=rep(1:12,length(yr1:yr2)))
fullalldat[covnames]=NA #add on covariates
#add year and month to alldat
alldat = cbind(Year=as.numeric(format(alldat$Dates,"%Y")),
Month=as.numeric(format(alldat$Dates,"%m")),
alldat)
#make sure each month is present in each year and file starts with Jan and ends with Dec
for(irow in 1:dim(alldat)[1]){
fullalldat[fullalldat$Year==alldat$Year[irow] & fullalldat$Month==alldat$Month[irow],covnames]=
alldat[irow,covnames]
}
if(save.csv) write.csv(fullalldat, paste(parameter,"-", id,"-",yr1,"-",yr2,".csv",sep=""),row.names=FALSE)
#clean up
if(clean) file.remove(Sys.glob("*.nc"))
invisible(fullalldat)
}
boxes14<-matrix(c(74.7, 12.5,
75.4, 11.5,
75.8, 10.5,
76, 9.5,
76.8, 8.5,
73.7, 12.5,
74.4, 11.5,
74.8, 10.5,
75, 9.5,
75.8, 8.5,
74, 9.5,
74.8, 8.5,
73.8, 8.5,
74.5, 14.5),ncol=14,nrow=2)
width<-rep(.5,times=14)
width[14]<-1.5
parameter <-'sea_surface_temperature'
id <- 'erdPH2sstdmday'
tag <- "SST."
erdPH2sstdmday=getdat(parameter, id, tag, boxctrs=boxes14, width)
# UPW SST based index using
# ICOADS sst 1960 onward
boxes.upw<-matrix(c(74.7, 12.5,
75.4, 11.5,
75.8, 10.5,
76, 9.5,
76.8, 8.5,
71.7, 12.5,
72.4, 11.5,
72.8, 10.5,
73, 9.5,
73.8, 8.5),ncol=10,nrow=2)
width=rep(.5,10)
parameter <-'sst'
id <- 'esrlIcoads1ge'
tag <- "SST."
sstupwelling=getdat(parameter, id, tag,  boxctrs=boxes.upw, width, save.csv=FALSE, include.z=FALSE)
upw.sst = with(sstupwelling,
data.frame(Year=Year, Month=Month,
UPW.1=SST.6-SST.1,
UPW.2=SST.7-SST.2,
UPW.3=SST.8-SST.3,
UPW.4=SST.9-SST.4,
UPW.5=SST.10-SST.5))
yr1=min(upw.sst$Year); yr2=max(upw.sst$Year)
upw.sst.icoad=upw.sst
write.csv(upw.sst, paste("upw.sst","-", id,"-",yr1,"-",yr2,".csv",sep=""),row.names=FALSE)
write.csv(upw.sst, paste("upw.sst","-", id,"-",yr1,"-",yr2,".csv",sep=""),row.names=FALSE)
parameter <-'sst'
id <- 'erdAGsstamday'
tag <- "SST."
sstAG=getdat(parameter, id, tag,  boxctrs=boxes.upw, width, save.csv=FALSE, include.z=TRUE)
upw.sst = with(sstAG,
data.frame(Year=Year, Month=Month,
UPW.1=SST.6-SST.1,
UPW.2=SST.7-SST.2,
UPW.3=SST.8-SST.3,
UPW.4=SST.9-SST.4,
UPW.5=SST.10-SST.5))
yr1=min(upw.sst$Year); yr2=max(upw.sst$Year)
upw.sst.AG=upw.sst
write.csv(upw.sst, paste("upw-sst","-", id,"-",yr1,"-",yr2,".csv",sep=""),row.names=FALSE)
dir()
id <- 'erdPH2sstnmday'
sstupwelling=read.csv("sea_surface_temperature-erdPH2sstnmday-1981-2012.csv")
upw.sst = with(sstupwelling,
data.frame(Year=Year, Month=Month,
UPW.1=SST.6-SST.1,
UPW.2=SST.7-SST.2,
UPW.3=SST.8-SST.3,
UPW.4=SST.11-SST.4,
UPW.5=SST.13-SST.5))
yr1=min(upw.sst$Year); yr2=max(upw.sst$Year)
write.csv(upw.sst, paste("upw-sst","-", id,"-",yr1,"-",yr2,".csv",sep=""),row.names=FALSE)
dir()
tapply(upw.sst$UPW.4,upw.sst$Month,mean)
tapply(upw.sst$UPW.4,upw.sst$Month,mean,na.rm=TRUE)
tapply(upw.sst$UPW.5,upw.sst$Month,mean,na.rm=TRUE)
tapply(upw.sst$UPW.3,upw.sst$Month,mean,na.rm=TRUE)
dir()
source('~/Dropbox/__MyFiles Archive/PAPERS/2016 India Sardine Forecasting/Analyses/Forecasting_Paper1_Pkg/data/raw data files and code/get_satellite_data/create_satellite_covariates.r')
source('~/Dropbox/__MyFiles Archive/PAPERS/2016 India Sardine Forecasting/Analyses/Forecasting_Paper1_Pkg/data/raw data files and code/get_satellite_data/create_satellite_covariates.r')
source('~/Dropbox/__MyFiles Archive/PAPERS/2016 India Sardine Forecasting/Analyses/Forecasting_Paper1_Pkg/data/raw data files and code/get_satellite_data/create_satellite_covariates.r')
source('~/Dropbox/__MyFiles Archive/PAPERS/2016 India Sardine Forecasting/Analyses/Forecasting_Paper1_Pkg/data/raw data files and code/get_satellite_data/create_satellite_covariates.r')
source('~/Dropbox/__MyFiles Archive/PAPERS/2016 India Sardine Forecasting/Analyses/Forecasting_Paper1_Pkg/data/raw data files and code/get_satellite_data/create_satellite_covariates.r')
source('~/Dropbox/__MyFiles Archive/PAPERS/2016 India Sardine Forecasting/Analyses/Forecasting_Paper1_Pkg/data/raw data files and code/create_covariate_monthly.r')
setwd("~/Dropbox/__MyFiles Archive/PAPERS/2016 India Sardine Forecasting/Analyses/Forecasting_Paper1_Pkg/data/raw data files and code")
source('~/Dropbox/__MyFiles Archive/PAPERS/2016 India Sardine Forecasting/Analyses/Forecasting_Paper1_Pkg/data/raw data files and code/create_covariate_monthly.r')
source('~/Dropbox/__MyFiles Archive/PAPERS/2016 India Sardine Forecasting/Analyses/Forecasting_Paper1_Pkg/data/raw data files and code/create_quarterly_covariates.r')
setwd("~/Dropbox/__MyFiles Archive/PAPERS/2016 India Sardine Forecasting/Analyses/Forecasting_Paper1_Pkg/data/raw data files and code/get_satellite_data")
dir()
rm(list=ls())
